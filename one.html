<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        background: #212121;
        margin: 0;
        padding: 0;
      }

      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
      }

      .slotcontainer {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 20px;
      }

      .slot {
        width: 100px;
        height: 267.5px;
        border: 1px solid black;
        border-radius: 7.5px;
        display: inline-block;
        overflow: hidden;
        position: relative;
        background: #fafafa;
        box-shadow: 0 0 3px 2px rgba(0, 0, 0, 0.4) inset;
      }

      .slot .symbols {
        position: absolute;
        top: 0;
        left: 0;
        transition: top 4s;
      }

      .slot .symbol {
        width: 100px;
        height: 85px;
        font-size: 60px;
        line-height: 100px;
        display: block;
        text-align: center;
      }

      button {
        margin: 0 10px;
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        border-radius: 5px;
      }

      .levercontainer {
        position: relative;
        margin-left: 20px;
      }

      .lever {
        background: grey;
        height: 250px;
        width: 25px;
        border-radius: 10px;
        margin-top: -40px;
        margin-left: 15px;
        box-shadow: 0 0 3px 2px rgba(0, 0, 0, 0.4) inset;
      }

      .levertip {
        background: red;
        height: 55px;
        width: 55px;
        border-radius: 50%;
        position: relative;
        box-shadow: 0 0 3px 2px rgba(0, 0, 0, 0.4) inset;
      }

      .dividerhr {
        margin: 2px 10px;
      }

      .spinAmount {
        width: 60px;
        border: none;
        border-radius: 5px;
        margin-left: 10px;
      }

      .footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        color: white;
        padding: 10px;
        text-align: center;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="slotcontainer">
        <!-- æ¯ä¸€åˆ— -->
        <div class="slot">
          <div class="symbols" id="slot1Symbols"></div>
        </div>

        <div class="slot">
          <div class="symbols" id="slot2Symbols"></div>
        </div>

        <div class="slot">
          <div class="symbols" id="slot3Symbols"></div>
        </div>

        <div class="slot">
          <div class="symbols" id="slot4Symbols"></div>
        </div>

        <div class="slot">
          <div class="symbols" id="slot5Symbols"></div>
        </div>

        <!-- å³è¾¹çš„å“ªä¸ªç©æ„ -->
        <div class="levercontainer">
          <div class="levertip"></div>
          <div class="lever"></div>
        </div>
      </div>

      <div style="display: flex">
        <button onclick="spin()">Spin</button>
        <button onclick="reset();">Reset</button>
        <hr class="dividerhr" />
        <input class="spinAmount" type="number" placeholder="e.g. 25" />
        <button onclick="autoSpin();">Auto</button>
      </div>
    </div>

    <div class="footer">
      made with â¤ï¸ by
      <a style="color: white" href="https://github.com/jcjms" target="_blank"
        >jcjms</a
      >
    </div>

    <script>
      // æ•°æ®
      const slotSymbols = [
        [
          "ğŸ˜€",
          "ğŸ˜",
          "ğŸ˜‚",
          "ğŸ˜ƒ",
          "ğŸ˜„",
          "ğŸ˜…",
          "ğŸ˜†",
          "ğŸ˜‡",
          "ğŸ˜ˆ",
          "ğŸ˜‰",
          "ğŸ˜Š",
          "ğŸ™‚",
        ],
        [
          "ğŸ",
          "ğŸ",
          "ğŸ",
          "ğŸŠ",
          "ğŸ‹",
          "ğŸŒ",
          "ğŸ‰",
          "ğŸ‡",
          "ğŸ“",
          "ğŸˆ",
          "ğŸ’",
          "ğŸ‘",
        ],
        [
          "â­ï¸",
          "ğŸŒŸ",
          "âœ¨",
          "ğŸ’«",
          "âš¡ï¸",
          "â˜„ï¸",
          "ğŸŒ ",
          "ğŸŒŒ",
          "ğŸŒ™",
          "ğŸŒ•",
          "ğŸŒ–",
          "ğŸŒ—",
        ],
        [
          "ğŸ”",
          "ğŸ•",
          "ğŸŒ­",
          "ğŸŸ",
          "ğŸ—",
          "ğŸ–",
          "ğŸŒ®",
          "ğŸŒ¯",
          "ğŸ¥™",
          "ğŸ",
          "ğŸœ",
          "ğŸ²",
        ],
        [
          "ğŸ©",
          "ğŸª",
          "ğŸ‚",
          "ğŸ°",
          "ğŸ«",
          "ğŸ¬",
          "ğŸ­",
          "ğŸ®",
          "ğŸ¦",
          "ğŸ¨",
          "ğŸ§",
          "ğŸ¥",
        ],
      ];

      // æ‰“ä¹±æ•°æ®å‡½æ•°
      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }

      // å°†æŠŠæ•°ç»„é‡Œçš„æ•°æ®ä¸­çš„æ•°æ®å¯¹åº”ä¸€ä¸ªå…ƒç´ ï¼Œä¸ºæ¯ä¸€å­™å­å…ƒç´ æ·»åŠ ç±»åsymbol
      function createSymbolElement(symbol) {
        const div = document.createElement("div");
        div.classList.add("symbol");
        div.textContent = symbol;
        return div;
      }

      //ç¬¬ä¸€æ¬¡ç‚¹spin(),ä¸æ‰§è¡Œé‡ç½®æ•°æ®
      let spun = false;

      // çˆ·çˆ·æ•°ç»„
      const slots = document.querySelectorAll(".slot");

      // transiton-delayçš„å»¶è¿Ÿæ—¶é—´
      const transitionDelay = 300;

      /*
       *å°†æ•°æ®æ‰“ä¹±ï¼Œç„¶åå°†æ•°ç»„ä¸­çš„æ•°ç»„å˜ä¸ºå­™å­å…ƒç´ ï¼Œå¹¶å°†å…¶ç±»åå‘½åä¸ºsymbol
       *å¹¶è®¾ç½®æ¯ä¸€åˆ—æ‰§è¡Œæ»šåŠ¨çš„æ—¶é—´ï¼Œåœ¨å‡½æ•°æœ€åä¸€è¡Œ
       */
      function generate() {
        // slotsæ˜¯ä¸€ç¾¤çˆ·çˆ·ï¼Œæ•°ç»„ï¼Œéå†.soltæ ‡ç­¾ï¼Œå¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œä¸€ä¸ªæ‰“ä¹±
        slots.forEach((slot, index) => {
          for (let i = 0; i < slotSymbols.length; i++) {
            shuffleArray(slotSymbols[i]);
          }

          // æ‹¿åˆ°æ‰€æœ‰çš„çˆ·çˆ·å…ƒç´ ä¸­çš„å­å…ƒç´ 
          const symbols = slot.querySelector(".symbols");
          
          // æ‹¿åˆ°å­™å­å…ƒç´ çš„é«˜
          const symbolHeight = symbols.querySelector(".symbol")?.clientHeight;

          // æ‰€æœ‰çš„å­™å­å…ƒç´ 
          const symbolCount = symbols.childElementCount;

          // å­å…ƒç´ å…ˆä¸ºç©ºå€¼
          symbols.innerHTML = "";

          // éå†æ•°æ®ä¸­æ•°ç»„ï¼Œå¯ä»¥è¯´æ˜¯å­™å­å…ƒç´ 
          slotSymbols[index].forEach((symbol) => {
            // åˆ›å»ºå­™å­å…ƒç´ å°†å…¶æ·»åŠ åˆ°å­å…ƒç´ ä¸­
            symbols.appendChild(createSymbolElement(symbol));
          });

          // è®¾ç½®å­å…ƒç´ çš„å»¶è¿Ÿæ—¶é—´ï¼›transitionDelay=300ï¼Œindex:0,1,2,3,4
          symbols.style.transitionDelay = `${transitionDelay * index}ms`;
        });
      }

      /*
       *ç‚¹å‡»å¼€å§‹
       *ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼Œä¸é‡ç½®æ•°æ®ï¼Œå¾€åé‡ç½®æ•°æ®
       *è¿›è¡Œç§»åŠ¨å¤šå°‘px
       *æ‰§è¡Œåˆ°æœ€åä¸€åˆ—ï¼Œæ˜¾ç¤ºå‡ºé¡µé¢çš„å†…å®¹
       *è¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œå½“æ˜¾ç¤ºå‡ºé¡µé¢æ‰€æœ‰å†…å®¹ä¹‹åï¼Œè¿”å›æˆåŠŸresolve
       *
       */
      function spin() {
        return new Promise((resolve) => {
          // ç¬¬ä¸€æ¬¡ spun=false å¸ƒå°”å€¼ï¼Œä¸æ‰§è¡Œé‡ç½®æ•°æ®
          if (spun) {
            // é‡ç½®æ•°æ®,å¯¹å„¿å­çš„è¿‡æ¸¡èµ‹ç©ºå€¼ï¼Œå¯¹å®šä½topèµ‹å€¼ä¸º0
            reset();
          }

          let completedSlots = 0;

          // éå†çˆ·çˆ·æ•°ç»„
          slots.forEach((slot, index) => {
            //æ‹¿åˆ°æ¯ä¸€ä¸ªå­å…ƒç´ 
            const symbols = slot.querySelector(".symbols");
            // å­™å­å…ƒç´ çš„å†…å®¹é«˜
            const symbolHeight = symbols.querySelector(".symbol")?.clientHeight;
            //å­™å­æ•°é‡
            const symbolCount = symbols.childElementCount;

            // å­™å­æ•°é‡ä¹˜ä»¥å­™å­å…ƒç´ å†…å®¹é«˜,å¯ä»¥å¾—å‡ºå­å…ƒç´ çš„æ€»é«˜
            const totalDistance = symbolCount * symbolHeight;
            // å­™å­æ•°é‡å‡ä»¥3ä¹˜ä»¥å­å…ƒç´ å†…å®¹é«˜,æ³¨æ„è¿™é‡Œæ˜¯è´Ÿæ•°
            const randomOffset = -(symbolCount - 3) * symbolHeight;

            // è¿™é‡Œå­å…ƒç´ ä¼šå‘ä¸Šç§»åŠ¨8ä¸ªå­™å­å…ƒç´ çš„æ€»é«˜åº¦
            symbols.style.top = `${randomOffset}px`;

            // å­å…ƒç´ æ·»åŠ transitionend
            // transitionend äº‹ä»¶çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œåœ¨æŸä¸ª CSS transition å®Œæˆæ—¶è§¦å‘
            symbols.addEventListener(
              "transitionend",
              () => {
                completedSlots++;
                // completedSlotsç­‰ä¸ç­‰äºçˆ·çˆ·æ•°ç»„æ•°é‡ï¼Œéå†çˆ·çˆ·æ•°ç»„åˆ°æœ€åä¸€ä¸ªæ‰æ‰§è¡Œ
                if (completedSlots === slots.length) {
                  // è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æ˜¾ç¤ºå‡ºé¡µé¢ä¸­æ‰€æœ‰çš„å†…å®¹
                  logDisplayedSymbols();
                  //å¾€åå°†é‡ç½®æ•°æ®
                  spun = true;
                  // è¿”å›æˆåŠŸpromiseï¼Œè¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†ç‚¹å‡»autoæ—¶ï¼Œæ‰§è¡Œä¸€éä¹‹åï¼Œéœ€è¦ç­‰å¾…
                  // ç¬¬ä¸€éæ‰§è¡Œå®Œï¼Œè¿›è¡Œç­‰å¾…ç¬¬äºŒæ¬¡æ‰§è¡Œçš„æ—¶é—´
                  resolve();
                }
              },
              // onceä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå›è°ƒå‡½æ•°åœ¨æ·»åŠ ä¹‹åæœ€å¤šåªè°ƒç”¨ä¸€æ¬¡ã€‚
              // å¦‚æœä¸º trueï¼Œå›è°ƒå‡½æ•°ä¼šåœ¨å…¶è¢«è°ƒç”¨ä¹‹åè‡ªåŠ¨ç§»é™¤ã€‚
              { once: true }
            );
          });
        });
      }

      // æ‹¿åˆ°è¾“å…¥æ¡†
      const spinAmountInput = document.querySelector(".spinAmount");

      // ç‚¹å‡»autoæ‰§è¡Œå®ƒ
      async function autoSpin() {
        // æ‹¿åˆ°è¾“å…¥æ¡†çš„å€¼
        let spinAmount = spinAmountInput.value;
        // åˆ¤æ–­å€¼æ˜¯å¦ä¸ºç©ºï¼Œæœ‰è¾“å…¥å€¼æ‰æ‰§è¡Œ
        if (spinAmount) {
          // è¾“å…¥æ¡†çš„è¾¹æ¡†ä¸ºé»‘è‰²æ¡†
          spinAmountInput.style.border = "none";
          // å¯¹è¾“å…¥çš„å€¼è¿›è¡Œä¸€ä¸ªå¾ªç¯
          // è¿™é‡Œæ²¡æœ‰é™åˆ¶è¾“å…¥æ¬¡æ•°çš„æœ€å¤§å€¼ï¼Œéœ€è¦è¿›è¡Œé™åˆ¶
          for (let i = 0; i < spinAmount; i++) {
            /*
             *ç‚¹å‡»å¼€å§‹
             *ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼Œä¸é‡ç½®æ•°æ®ï¼Œå¾€åé‡ç½®æ•°æ®
             *è¿›è¡Œç§»åŠ¨å¤šå°‘px
             *æ‰§è¡Œåˆ°æœ€åä¸€åˆ—ï¼Œæ˜¾ç¤ºå‡ºé¡µé¢çš„å†…å®¹
             *æ˜¾ç¤ºæ‰€æœ‰å†…å®¹ä¹‹åè¿”å›resolve
             */
            await spin();

            await new Promise((resolve) =>
              // ç­‰å¾…ä¸€æ®µæ—¶é—´åå†å¼€å§‹ä¸‹ä¸€æ¬¡æ—‹è½¬
              // å…¨å±€transitionDelayï¼Œçˆ·çˆ·æ•°ç»„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯ï¼š300*5=1.5ç§’
              {
                setTimeout(resolve, transitionDelay * slots.length);
              }
            );
          }
        } else {
          // ç‚¹å‡»autoé”®ä¸”å€¼ä¸ºç©ºæ‰æ‰§è¡Œ
          spinAmountInput.style.border = "2px solid red";
        }
      }

      // é‡ç½®æ•°æ®,å¯¹å„¿å­çš„è¿‡æ¸¡èµ‹ç©ºå€¼ï¼Œå¯¹å®šä½topèµ‹å€¼ä¸º0
      function reset() {
        // æ‹¿åˆ°çˆ·çˆ·æ•°ç»„ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨å…¨å±€çˆ·çˆ·æ•°ç»„
        const slots = document.querySelectorAll(".slot");

        slots.forEach((slot) => {
            console.log(slot)
          // æ‹¿åˆ°å„¿å­
          const symbols = slot.querySelector(".symbols");
          // å¯¹å„¿å­è¿‡æ¸¡èµ‹ç©ºå€¼
          symbols.style.transition = "none";
          // å¯¹å„¿å­ç»å¯¹å®šä½èµ‹0
          symbols.style.top = "0";
          // å­å…ƒç´ çš„æ€ªå¼‚ç›’æ¨¡å‹çš„é«˜
          symbols.offsetHeight;
          //å¯¹å„¿å­è¿‡æ¸¡èµ‹ç©ºå€¼
          symbols.style.transition = "";
        });

        generate();
      }

      // éå†çˆ·çˆ·æ•°ç»„åˆ°æœ€åä¸€ä¸ªæ‰æ‰§è¡Œï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æ˜¾ç¤ºå‡ºé¡µé¢ä¸­æ‰€æœ‰çš„å†…å®¹
      function logDisplayedSymbols() {
        // å±€éƒ¨çˆ·çˆ·æ•°ç»„;è¿™é‡Œä¸ºä»€ä¹ˆä¸æ‹¿å¤–é¢çš„çˆ·çˆ·æ•°ç»„ï¼Œè€Œè¦é‡æ–°å®šä¹‰ä¸€ä¸ª
        const slots = document.querySelectorAll(".slot");

        // äºŒç»´æ•°ç»„ï¼Œæ€»å…±ä¸‰è¡Œï¼Œæ‰€ä»¥å†™ä¸‰ä¸ªæ•°ç»„ä¸­çš„æ•°ç»„
        const displayedSymbols = [[], [], []];

        slots.forEach((slot) => {
          // æ¯ä¸€ä¸ªå­å…ƒç´ 
          const symbols = slot.querySelector(".symbols");

          // symbols.textContentï¼šå­™å­å…ƒç´ çš„å†…å®¹æ˜¯stringç±»å‹;å°†å®ƒä»¬å˜æˆä¸€ä¸ªæ•°ç»„
          const symbolArray = Array.from(symbols.textContent);

          //å­™å­å†…å®¹æ•°ç»„ä¸ºï¼šç¬¬ä¸€è¡Œï¼šå› ä¸ºtopä¸Šå‡8ä½ï¼Œæ‰€ä»¥æ˜¯ç¬¬9ä¸ª
          displayedSymbols[0].push(symbolArray[symbolArray.length - 3]);
          //å­™å­å†…å®¹æ•°ç»„ä¸ºï¼šç¬¬äºŒè¡Œï¼šç¬¬10ä¸ª
          displayedSymbols[1].push(symbolArray[symbolArray.length - 2]);
          //å­™å­å†…å®¹æ•°ç»„ä¸ºï¼šç¬¬äºŒè¡Œï¼šç¬¬11ä¸ªï¼Œæœ€åä¸€ä¸ª
          displayedSymbols[2].push(symbolArray[symbolArray.length - 1]);
        });

        // æ‹¿åˆ°é¡µé¢ä¸­çš„ç»“æœ
        displayedSymbols.forEach((symbols, index) => {
          console.log(`Displayed symbols(row ${index + 1}): ${symbols}`);
        });
      }

      //å³è¾¹çš„ä¸Šé¢å“ªä¸ªçº¢è‰²ç©æ„
      document
        .querySelector(".levertip")
        .addEventListener("click", function () {
          spin();
        });

      /*
       *å¼€å§‹å°±
       *å°†æ•°æ®æ‰“ä¹±ï¼Œç„¶åå°†æ•°ç»„ä¸­çš„æ•°ç»„å˜ä¸ºå­™å­å…ƒç´ ï¼Œå¹¶å°†å…¶ç±»åå‘½åä¸ºsymbol
       *å¹¶è®¾ç½®æ¯ä¸€åˆ—æ‰§è¡Œæ»šåŠ¨çš„æ—¶é—´ï¼Œåœ¨å‡½æ•°æœ€åä¸€è¡Œ
       */
      generate();
    </script>
  </body>
</html>
